<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ ‚Äî –ê—Ä—Å–µ–Ω–∞–ª</title>
<meta name="description" content="–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ –ê—Ä—Å–µ–Ω–∞–ª–∞ ‚Äî —Ä–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–ø—É—Ç–∞—Ü–∏–∏, —Å—Ä–∞–≤–Ω–∏—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –≤–µ—Å." />
<meta name="theme-color" content="#0b0b0d" />
<style>
:root{
  --bg-1:#0b0b0d; --bg-2:#15161a;
  --card:#17181c; --muted:#a6b0bf;
  --accent-gold:#d4b85c; --accent-orange:#ed8936; --accent-green:#3ea66a;
  --danger:#d46b6b;
  --radius:12px;
  --gap:16px;
  --maxw:1700px; /* —É–≤–µ–ª–∏—á–µ–Ω–æ –Ω–∞ 400px (–∏–∑ 1300 -> 1700) */
  color-scheme: dark;
  font-family: Inter, Roboto, "Helvetica Neue", Arial, sans-serif;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{
  background: linear-gradient(180deg,var(--bg-1),var(--bg-2));
  color:#e7eef6;
  padding:20px;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}
/* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç–∞–ª —à–∏—Ä–µ –∑–∞ —Å—á—ë—Ç --maxw */
.wrap{max-width:var(--maxw);margin:0 auto;display:grid;grid-template-columns:1fr 380px;gap:20px;align-items:start;} /* —É–≤–µ–ª–∏—á–∏–ª –ø—Ä–∞–≤—É—é –∫–æ–ª–æ–Ω–∫—É –¥–æ 380px */
@media (max-width:1000px){.wrap{grid-template-columns:1fr; padding:12px}}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:var(--radius);padding:14px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 10px 30px rgba(0,0,0,0.6)}
.header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding-bottom:6px;border-bottom:1px solid rgba(255,255,255,0.02)}
.title h1{font-size:1.25rem;margin:0;display:flex;gap:10px;align-items:center}
.title p{margin:0;color:var(--muted);font-size:0.9rem}

/* toolbar: —Å–Ω–∞—á–∞–ª–∞ –≤–≤–æ–¥ –∏ –∫–Ω–æ–ø–∫–∞, –∑–∞—Ç–µ–º –ø–æ–∏—Å–∫ –ø–æ–¥ –Ω–∏–º–∏ */
.toolbar{display:flex;flex-direction:column;gap:10px;margin-top:12px}
.toolbar-row{display:flex;gap:8px;align-items:center}
.controls-right{margin-left:auto;display:flex;align-items:center}

/* –ø–æ–ª—è –∏ –∫–Ω–æ–ø–∫–∏ */
.input{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;min-width:150px}
.btn{padding:10px 12px;border-radius:10px;border:none;cursor:pointer;background:linear-gradient(135deg,var(--accent-gold), #c9b05a);color:#0d0d0d;font-weight:700}
.small{padding:6px 8px;font-size:0.9rem;border-radius:8px}

/* –ü–æ–∏—Å–∫ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π –ø–æ–¥ –≤–≤–æ–¥–æ–º */
.search{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;width:100%;min-width:160px}

/* tabs: –ù–ï–∞–∫—Ç–∏–≤–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –≤—ã–¥–µ–ª—è—Ç—å—Å—è –ø–æ –∫–æ–Ω—Ç—É—Ä—É ‚Äî —É–≤–µ–ª–∏—á–∏–º –≤–∏–¥–∏–º–æ—Å—Ç—å —Ä–∞–º–∫–∏ */
.tabs{display:flex;gap:8px}
.tab{
  padding:8px 12px;border-radius:8px;background:transparent;border:2px solid rgba(255,255,255,0.08);cursor:pointer;color:var(--muted);font-weight:700;
  transition:all 140ms ease;
}
/* –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ —É—Å–∏–ª–∏—Ç—å –∫–æ–Ω—Ç—É—Ä */
.tab:hover{border-color:rgba(212,184,92,0.18);color:#fff}
.tab.active{background:linear-gradient(90deg, rgba(212,184,92,0.12), rgba(212,184,92,0.06));color: #fff; border-color: rgba(212,184,92,0.25)}

/* —Ç–∞–±–ª–∏—Ü–∞: —Å–æ—Ö—Ä–∞–Ω—è–µ–º layout –∏ —Ä–∞–∑–º–µ—Ä—ã —è—á–µ–µ–∫, –Ω–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É */
.table-wrap{margin-top:14px;border-radius:10px;overflow-x:hidden;background:transparent}
.table{width:100%;border-collapse:collapse;table-layout:fixed;font-size:0.95rem}
thead th{position:sticky;top:0;background:linear-gradient(180deg, rgba(10,12,16,0.7), rgba(10,12,16,0.6));padding:12px 8px;color:var(--accent-gold);font-weight:700;border-bottom:2px solid rgba(255,255,255,0.03);text-align:center}
tbody td{padding:12px 8px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.02);line-height:1.4;white-space:normal;word-break:keep-all;overflow-wrap:break-word}
tr:hover td{background:rgba(255,255,255,0.01);transform:translateX(4px);transition:transform 180ms}
.col-name{text-align:left;padding-left:12px}
.bad-option{background:rgba(212,107,107,0.06);border-left:4px solid rgba(212,107,107,0.18)}
.good-option{background:rgba(237,137,54,0.06);border-left:4px solid rgba(237,137,54,0.18)}
.best-option{background:rgba(62,166,106,0.06);border-left:4px solid rgba(62,166,106,0.2)}

/* —Å–æ—Ö—Ä–∞–Ω—è–µ–º —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–æ–∫ (—Ç—ã –ø—Ä–æ—Å–∏–ª –Ω–µ –º–µ–Ω—è—Ç—å —Ä–∞–∑–º–µ—Ä—ã —è—á–µ–µ–∫) */
th.col-name, td.col-name{width:28%;min-width:160px}
th.col-death, td.col-death{width:8%;min-width:70px}
th.col-weight, td.col-weight{width:6%;min-width:60px}
th.col-rep, td.col-rep{width:8%;min-width:70px}
th.col-price, td.col-price{width:10%;min-width:90px}
th.col-rep-price, td.col-rep-price{width:10%;min-width:90px}
th.col-quantity, td.col-quantity{width:8%;min-width:70px}
th.col-total-weight, td.col-total-weight{width:8%;min-width:80px}
th.col-total-cost, td.col-total-cost{width:12%;min-width:110px}
@media (max-width:760px){
  th.col-name, td.col-name{width:40%}
  thead th, tbody td{font-size:0.9rem;padding:10px 6px}
}

/* –ø–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ø–æ–∏—Å–∫–∞ */
.match{background:linear-gradient(90deg, rgba(212,184,92,0.14), rgba(212,184,92,0.04));padding:0 2px;border-radius:2px;color:inherit}

/* Sidebar widget (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞) - –ò–°–ü–†–ê–í–õ–ï–ù–ê */
.sidebar{position:sticky;top:20px;align-self:start;min-height:400px} /* –¥–æ–±–∞–≤–∏–ª –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É */
.sidebar .card{padding:16px;min-height:400px;display:flex;flex-direction:column} /* —É–≤–µ–ª–∏—á–∏–ª –æ—Ç—Å—Ç—É–ø—ã –∏ –¥–æ–±–∞–≤–∏–ª flex */
.widget{display:flex;flex-direction:column;gap:12px;flex:1} /* –∏–∑–º–µ–Ω–∏–ª –Ω–∞ flex column */
.widget-grid{display:grid;grid-template-columns:1fr;gap:12px;width:100%} /* –∏–∑–º–µ–Ω–∏–ª –Ω–∞ –æ–¥–Ω—É –∫–æ–ª–æ–Ω–∫—É */
.widget-card{
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  padding:14px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.03);
  box-shadow:0 8px 20px rgba(0,0,0,0.45);
  transition:transform 180ms;
  width:100%;
  min-height:80px;
  display:flex;
  flex-direction:column;
  justify-content:center;
}
.widget-card.best{border-left:6px solid rgba(62,166,106,0.9)}
.widget-card.good{border-left:6px solid rgba(237,137,54,0.9)}
.widget-card.bad{border-left:6px solid rgba(212,107,107,0.9)}
.widget-card h4{margin:0 0 8px 0;font-size:0.95rem;display:flex;gap:8px;align-items:center}
.widget-card p{margin:0;font-weight:700;color:var(--muted);font-size:0.9rem;line-height:1.3}
.widget-card .meta{font-size:0.85rem;color:var(--muted);margin-top:4px;line-height:1.2}
.footer-note{font-size:0.85rem;color:var(--muted);margin-top:12px;text-align:center}

/* –í–∞–∂–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ü–µ–Ω–∞—Ö */
.price-warning{background:rgba(212,184,92,0.08);border:1px solid rgba(212,184,92,0.2);border-radius:8px;padding:12px;margin-top:12px;font-size:0.9rem}
.price-warning strong{color:var(--accent-gold);display:block;margin-bottom:4px}

/* visually-hidden for accessibility */
.visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
</style>
</head>
<body>
<div class="wrap">
  <main class="card" role="main" aria-labelledby="page-title">
    <header class="header">
      <div class="title">
        <h1 id="page-title">üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ ‚Äî –ê—Ä—Å–µ–Ω–∞–ª</h1>
        <p>–ê–≤—Ç–æ—Ä: Dante_AG</p>
      </div>
    </header>

    <!-- –í–∞–∂–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ü–µ–Ω–∞—Ö -->
    <div class="price-warning" role="alert" aria-live="polite">
      <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: —Ü–µ–Ω—ã –Ω–∞ –∞—É–∫—Ü–∏–æ–Ω–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –º–µ–Ω—è—é—Ç—Å—è</strong>
      <span>–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ —è–≤–ª—è–µ—Ç—Å—è –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ–π –∏ –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–π —Ä—ã–Ω–æ—á–Ω–æ–π —Ü–µ–Ω—ã.</span>
    </div>

    <!-- toolbar: –≤–µ—Ä—Ö–Ω—è—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –≤–≤–æ–¥ —Ä–µ–ø–∞ + –∫–Ω–æ–ø–∫–∞; —Å—Ç—Ä–æ–∫–∞ —Å–Ω–∏–∑—É ‚Äî –ø–æ–∏—Å–∫ -->
    <div class="toolbar" role="toolbar" aria-label="–ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤">
      <div class="toolbar-row">
        <input id="rep" class="input" type="number" min="1" max="1000000" value="30000" aria-label="–¢—Ä–µ–±—É–µ–º–∞—è —Ä–µ–ø—É—Ç–∞—Ü–∏—è">
        <button id="calculate-btn" class="btn" aria-label="–†–∞—Å—Å—á–∏—Ç–∞—Ç—å">–†–ê–°–°–ß–ò–¢–ê–¢–¨</button>

        <div class="controls-right">
          <div class="tabs" role="tablist" aria-label="–í–∏–¥—ã —Ä–∞—Å—á—ë—Ç–∞">
            <button class="tab active" data-tab="individual" role="tab" aria-selected="true">–û—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã</button>
            <button class="tab" data-tab="personal" role="tab">–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —è—â–∏–∫–∏</button>
            <button class="tab" data-tab="non-personal" role="tab">–ù–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —è—â–∏–∫–∏</button>
          </div>
        </div>
      </div>

      <!-- –ø–æ —Ç–≤–æ–µ–º—É –∂–µ–ª–∞–Ω–∏—é –ø–æ–∏—Å–∫ –ø–æ–¥ –∫–Ω–æ–ø–∫–æ–π -->
      <div class="toolbar-row">
        <input id="search" class="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—é (—Ç–µ–∫—É—â–∞—è –≤–∫–ª–∞–¥–∫–∞)" aria-label="–ü–æ–∏—Å–∫">
      </div>
    </div>

    <!-- Individual -->
    <div id="individual-panel" class="table-wrap" role="region" aria-labelledby="individual-label">
      <table class="table" aria-describedby="individual-label">
        <thead>
          <tr>
            <th id="individual-label" class="col-name">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞</th>
            <th class="col-death">–í—ã–ø–∞–¥–∞–µ—Ç –ø—Ä–∏ —Å–º–µ—Ä—Ç–∏</th>
            <th class="col-weight">–í–µ—Å</th>
            <th class="col-rep">–†–µ–ø—É—Ç–∞—Ü–∏—è –∑–∞ –µ–¥–∏–Ω–∏—Ü—É</th>
            <th class="col-price">–¶–µ–Ω–∞ –Ω–∞ –∞—É–∫—Ü–∏–æ–Ω–µ</th>
            <th class="col-rep-price">–¶–µ–Ω–∞ –µ–¥–∏–Ω–∏—Ü—ã —Ä–µ–ø—É—Ç–∞—Ü–∏–∏</th>
            <th class="col-quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</th>
            <th class="col-total-weight">–û–±—â–∏–π –≤–µ—Å</th>
            <th class="col-total-cost">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</th>
          </tr>
        </thead>
        <tbody id="individual-body"></tbody>
      </table>
    </div>

    <!-- Personal -->
    <div id="personal-panel" class="table-wrap" role="region" aria-labelledby="personal-label" style="display:none">
      <table class="table" aria-describedby="personal-label">
        <thead>
          <tr>
            <th id="personal-label" class="col-name">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞</th>
            <th class="col-quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Å—É—Ä—Å–∞</th>
            <th class="col-price">–¶–µ–Ω–∞ –Ω–∞ –∞—É–∫—Ü–∏–æ–Ω–µ</th>
            <th class="col-rep-price">–°—Ç–æ–∏–º–æ—Å—Ç—å —è—â–∏–∫–∞</th>
            <th class="col-rep-price">–°—Ç–æ–∏–º–æ—Å—Ç—å –µ–¥–∏–Ω–∏—Ü—ã —Ä–µ–ø—É—Ç–∞—Ü–∏–∏</th>
            <th class="col-quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —è—â–∏–∫–æ–≤</th>
            <th class="col-total-weight">–û–±—â–∏–π –≤–µ—Å</th>
            <th class="col-total-cost">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</th>
          </tr>
        </thead>
        <tbody id="personal-body"></tbody>
      </table>
    </div>

    <!-- Non-personal -->
    <div id="nonpersonal-panel" class="table-wrap" role="region" aria-labelledby="nonpersonal-label" style="display:none">
      <table class="table" aria-describedby="nonpersonal-label">
        <thead>
          <tr>
            <th id="nonpersonal-label" class="col-name">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞</th>
            <th class="col-quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Å—É—Ä—Å–∞</th>
            <th class="col-price">–¶–µ–Ω–∞ –Ω–∞ –∞—É–∫—Ü–∏–æ–Ω–µ</th>
            <th class="col-rep-price">–°—Ç–æ–∏–º–æ—Å—Ç—å —è—â–∏–∫–∞</th>
            <th class="col-rep-price">–°—Ç–æ–∏–º–æ—Å—Ç—å –µ–¥–∏–Ω–∏—Ü—ã —Ä–µ–ø—É—Ç–∞—Ü–∏–∏</th>
            <th class="col-quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —è—â–∏–∫–æ–≤</th>
            <th class="col-total-weight">–û–±—â–∏–π –≤–µ—Å</th>
            <th class="col-total-cost">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</th>
          </tr>
        </thead>
        <tbody id="nonpersonal-body"></tbody>
      </table>
    </div>
  </main>

  <aside class="sidebar">
    <div class="card" aria-label="–°–≤–æ–¥–∫–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
        <h3 style="margin:0;font-size:1.1rem">üìä –°–≤–æ–¥–∫–∞ –ø–æ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º –≤–∞—Ä–∏–∞–Ω—Ç–∞–º</h3>
        <button id="refresh-summary" class="small" style="background:transparent;border:1px solid rgba(255,255,255,0.04);border-radius:8px;color:var(--muted);cursor:pointer;padding:6px 10px">–û–±–Ω–æ–≤–∏—Ç—å</button>
      </div>

      <div class="widget">
        <div class="widget-grid" id="summary"></div>
        <div class="footer-note">–õ—É—á—à–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏. –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞ ‚Äî –ø–æ–¥—Å–≤–µ—Ç–∏—Ç —Å—Ç—Ä–æ–∫—É —Ç–∞–±–ª–∏—Ü—ã.</div>
      </div>
    </div>
  </aside>
</div>

<!-- Templates -->
<template id="row-template">
  <tr>
    <td class="col-name"></td>
    <td class="col-death"></td>
    <td class="col-weight"></td>
    <td class="col-rep"></td>
    <td class="col-price"></td>
    <td class="col-rep-price"></td>
    <td class="col-quantity"></td>
    <td class="col-total-weight"></td>
    <td class="col-total-cost"></td>
  </tr>
</template>

<template id="box-row-template">
  <tr>
    <td class="col-name"></td>
    <td class="col-quantity"></td>
    <td class="col-price"></td>
    <td class="col-rep-price"></td>
    <td class="col-rep-price"></td>
    <td class="col-quantity"></td>
    <td class="col-total-weight"></td>
    <td class="col-total-cost"></td>
  </tr>
</template>

<template id="card-template">
  <div class="widget-card">
    <h4><span class="icon" aria-hidden="true"></span><span class="type-label"></span></h4>
    <p class="name"></p>
    <small class="meta"></small>
  </div>
</template>

<script>
/* CONFIG (—Ç–≤–æ–π –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö) */
const CONFIG = {
  individualItems: [
    { name: "–î–æ—Ä–æ–≥–∏–µ —Å–∏–≥–∞—Ä–µ—Ç—ã", deathDrop: true, weight: 0.3, repPerUnit: 6, price: 3200 },
    { name: "–ó–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è –ø–¥–∞", deathDrop: true, weight: 0.7, repPerUnit: 16, price: 8900 },
    { name: "–û–≥—Ä–æ–º–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç", deathDrop: true, weight: 0.5, repPerUnit: 2, price: 1250 },
    { name: "–û–±—ã—á–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç", deathDrop: true, weight: 0.3, repPerUnit: 1, price: 1000 },
    { name: "–û—Å—Ç–∞—Ç–∫–∏ –ø—Ä–∏–±–æ—Ä–æ–≤ ¬´–®–µ–ø–æ—Ç–∞¬ª", deathDrop: true, weight: 2.5, repPerUnit: 100, price: 67000 },
    { name: "–§–∏–ª—å—Ç—Ä", deathDrop: true, weight: 0.5, repPerUnit: 10, price: 4500 },
    { name: "–î—Ä–∞–≥–æ—Ü–µ–Ω–Ω–æ—Å—Ç–∏", deathDrop: true, weight: 0.2, repPerUnit: 55, price: 38000 },
    { name: "–ú–∞–ª—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç", deathDrop: true, weight: 0.2, repPerUnit: 1, price: 710 },
    { name: "–†—É–∫–∞ —Å–∏–ª—å–Ω–æ–≥–æ —à–Ω—ã—Ä—è", deathDrop: true, weight: 0.5, repPerUnit: 5, price: 3000 },
    { name: "–ü—Ä–æ—Ç–æ–∞—Ä—Ç–µ—Ñ–∞–∫—Ç", deathDrop: true, weight: 0, repPerUnit: 5, price: 3800 },
    { name: "–ë–æ–ª—å—à–æ–π —è—â–∏–∫ —Å –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º", deathDrop: true, weight: 6, repPerUnit: 9, price: 7000 },
    { name: "–ß–µ—Ä–Ω–∞—è —Å–µ–ª–µ–∑–µ–Ω–∫–∞", deathDrop: true, weight: 1.6, repPerUnit: 150, price: 160000 },
    { name: "–°–µ—Ä–¥—Ü–µ –õ–∏–º–±", deathDrop: true, weight: 3, repPerUnit: 1000, price: 1050000 },
    { name: "–õ–æ—Å–∫—É—Ç —Å–≤–µ—Ç—è—â–µ–π—Å—è –∫–æ–∂–∏", deathDrop: true, weight: 0.4, repPerUnit: 10, price: 6200 },
    { name: "–ì–ª–∞–∑ —Å–∏–ª—å–Ω–æ–≥–æ –±—É—Ä–µ–ª–æ–º–∞", deathDrop: true, weight: 1, repPerUnit: 15, price: 13000 },
    { name: "–ú–µ–¥–Ω–∞—è –∫–∞—Ç—É—à–∫–∞", deathDrop: true, weight: 0.3, repPerUnit: 5, price: 9000 },
    { name: "–ö–æ—Å—Ç—å –º—É—Ç–∞–Ω—Ç–∞", deathDrop: true, weight: 2, repPerUnit: 6, price: 6000 },
    { name: "–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã", deathDrop: true, weight: 0.3, repPerUnit: 20, price: 25000 },
    { name: "–ö–æ–º–ø–ª–µ–∫—Ç –∑–∞–≤–æ–¥—Å–∫–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤", deathDrop: true, weight: 0.4, repPerUnit: 11, price: 25000 },
    { name: "–ë–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö ¬´–õ—è–º–±–¥–∞¬ª", deathDrop: false, weight: 0.2, repPerUnit: 150, price: 170000 },
    { name: "–ü—Ä–æ—Ç–æ—Ç–∏–ø—ã ¬´–®–µ–ø–æ—Ç–∞¬ª", deathDrop: true, weight: 0.3, repPerUnit: 55, price: 73000 },
    { name: "–Ø—â–∏–∫ —Å –¥–µ—Ç–∞–ª—è–º–∏", deathDrop: true, weight: 3, repPerUnit: 3, price: 3000 },
    { name: "–ö—Ä—É–ø–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç", deathDrop: true, weight: 0.4, repPerUnit: 1, price: 1500 },
    { name: "–°–æ–ª–µ–Ω–æ–∏–¥", deathDrop: true, weight: 0.4, repPerUnit: 2, price: 9000 },
    { name: "–†–∞—Å—Ü–≤–µ—Ç—à–∏–π –ì–æ—Ä—å–∫–æ–ª–∏—Å—Ç–Ω–∏–∫", deathDrop: false, weight: 0.05, repPerUnit: 65, price: 80000 },
    { name: "–ù–∞–±–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –±—Ä–æ–Ω–∏", deathDrop: false, weight: 0.2, repPerUnit: 2, price: 3100 },
    { name: "–¢–µ–º–Ω—ã–π –ª–∏–º–±", deathDrop: false, weight: 0.2, repPerUnit: 90, price: 150000 },
    { name: "–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–¥–∫–∏—Ö —Å–ø–ª–∞–≤–æ–≤", deathDrop: true, weight: 0.4, repPerUnit: 35, price: 55000 },
    { name: "–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–∏–º–±–æ–ø–ª–∞–∑–º–∞", deathDrop: false, weight: 0.3, repPerUnit: 800, price: 1250000 },
    { name: "–•—Ä–æ–Ω–æ—Å—Ñ–µ—Ä–∞", deathDrop: false, weight: 0.25, repPerUnit: 175, price: 320000 },
    { name: "–ù–æ—É—Ç–±—É–∫", deathDrop: true, weight: 10, repPerUnit: 12, price: 23000 },
    { name: "–°–∏—Å—Ç–µ–º—ã –Ω–∞–≤–µ–¥–µ–Ω–∏—è", deathDrop: true, weight: 0.4, repPerUnit: 16, price: 30000 },
    { name: "–ë–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö ¬´–ë–µ—Ç–∞¬ª", deathDrop: false, weight: 0.2, repPerUnit: 45, price: 85000 },
    { name: "–ö–≤–∞–Ω—Ç–æ–≤—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä", deathDrop: false, weight: 3, repPerUnit: 30, price: 55000 },
    { name: "–¶–≤–µ—Ç—É—â–∏–π —Ä—ã–∂–∏–π –ø–∞–ø–æ—Ä–æ—Ç–Ω–∏–∫", deathDrop: false, weight: 0.05, repPerUnit: 6, price: 12000 },
    { name: "–ú–∞–ª—ã–π —è—â–∏–∫ —Å –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º", deathDrop: true, weight: 1, repPerUnit: 1, price: 2000 },
    { name: "–Ø—â–∏–∫ —Å –∑–∞–ø—á–∞—Å—Ç—è–º–∏", deathDrop: true, weight: 2.5, repPerUnit: 1, price: 3000 },
    { name: "–ë–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö ¬´–ì–∞–º–º–∞¬ª", deathDrop: false, weight: 0.2, repPerUnit: 45, price: 95000 },
    { name: "–í–æ–µ–Ω–Ω—ã–π —Ä–∞–¥–∏–æ–ø–µ—Ä–µ–¥–∞—Ç—á–∏–∫", deathDrop: true, weight: 0.4, repPerUnit: 10, price: 30000 },
    { name: "–ë–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö ¬´–ê–ª—å—Ñ–∞¬ª", deathDrop: false, weight: 0.2, repPerUnit: 45, price: 90000 },
    { name: "–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞–Ω–æ–º–∞–ª—å–Ω–∞—è –±–∞—Ç–∞—Ä–µ—è", deathDrop: false, weight: 0.45, repPerUnit: 1000, price: 2600000 },
    { name: "–ü—Å–∏-–º–∞—è—á–æ–∫", deathDrop: false, weight: 0.15, repPerUnit: 7, price: 15000 },
    { name: "–û—á–∏—â–µ–Ω–Ω–æ–µ –≤–µ—â–µ—Å—Ç–≤–æ", deathDrop: false, weight: 0.05, repPerUnit: 9, price: 26000 },
    { name: "–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏", deathDrop: true, weight: 0.4, repPerUnit: 6, price: 15000 },
    { name: "–û–±—ã—á–Ω—ã–π —è—â–∏–∫ —Å –ø—Ä–æ–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º", deathDrop: true, weight: 2, repPerUnit: 3, price: 10000 },
    { name: "–ù–∞–±–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –æ—Ä—É–∂–∏—è", deathDrop: false, weight: 0.2, repPerUnit: 6, price: 38000 }
  ],
  personalBoxes: [
    { name: "–ü—Ä–æ—á–Ω—ã–π –º–µ—Ç–∞–ª–ª", resourcesNeeded: 2, resourcePrice: 80000 },
    { name: "–°–æ—Å—É–¥ —Ä–µ–∞–∫—Ç–æ—Ä–∞", resourcesNeeded: 2, resourcePrice: 120000 },
    { name: "–ò–∑–º–µ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ", resourcesNeeded: 2, resourcePrice: 80000 },
    { name: "–ó–∞—â–∏—Ç–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ", resourcesNeeded: 2, resourcePrice: 80000 },
    { name: "–ú—É—Ç–∞–≥–µ–Ω", resourcesNeeded: 1, resourcePrice: 180000 },
    { name: "–ù–µ–π—Ä–æ–¥–µ–≥–µ–Ω–µ—Ä–∞–Ω—Ç", resourcesNeeded: 15, resourcePrice: 15000 },
    { name: "–¢–µ–ª–æ–º–µ—Ä–∞–∑–∞", resourcesNeeded: 1, resourcePrice: 150000 },
    { name: "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —ç–ª–µ–∫—Ç—Ä–æ–¥", resourcesNeeded: 9, resourcePrice: 20000 },
    { name: "–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —É—Å–∏–ª–∏—Ç–µ–ª—å", resourcesNeeded: 3, resourcePrice: 60000 },
    { name: "–†–æ—Ç–æ—Ä–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞", resourcesNeeded: 3, resourcePrice: 70000 },
    { name: "–°–≤–µ—Ä–ª–æ", resourcesNeeded: 4, resourcePrice: 70000 }
  ],
  nonPersonalBoxes: [
    { name: "–ù–∞–±–æ—Ä –±–æ–ª—Ç–æ–≤", resourcesNeeded: 9, resourcePrice: 15000 },
    { name: "–ú–∞—è—á–æ–∫ –≥—Ä—É–ø–ø—ã –ì–∞–º–º–∞", resourcesNeeded: 16, resourcePrice: 0 },
    { name: "–ú–∞—è—á–æ–∫ –≥—Ä—É–ø–ø—ã –ë–µ—Ç–∞", resourcesNeeded: 16, resourcePrice: 0 },
    { name: "–ú–∞—è—á–æ–∫ –≥—Ä—É–ø–ø—ã –ê–ª—å—Ñ–∞", resourcesNeeded: 16, resourcePrice: 0 },
    { name: "–ü—É—Ä–ø—É—Ä–Ω—ã–µ –º–∏–Ω–µ—Ä–∞–ª—ã", resourcesNeeded: 300, resourcePrice: 900 },
    { name: "–Ø–Ω—Ç–∞—Ä–Ω–∞—è –ø–æ–ª—ã–Ω—å", resourcesNeeded: 8, resourcePrice: 15000 },
    { name: "–ì–Ω–æ–∑–∏—Å", resourcesNeeded: 500, resourcePrice: 1000 },
    { name: "–≠–ª–µ–∫—Ç—Ä–æ–¥–≤–∏–≥–∞—Ç–µ–ª—å", resourcesNeeded: 19, resourcePrice: 5000 },
    { name: "–ß–µ—Ä—Ç–æ—Ü–≤–µ—Ç", resourcesNeeded: 45, resourcePrice: 2500 },
    { name: "–ê–ª—ã–µ –º–∏–Ω–µ—Ä–∞–ª—ã", resourcesNeeded: 130, resourcePrice: 1000 },
    { name: "–ú—É—Ç–∏—Ä–æ–≤–∞–≤—à–∏–µ —Ñ–µ—Ä–º–µ–Ω—Ç—ã", resourcesNeeded: 10, resourcePrice: 11600 },
    { name: "–ó–æ–ª–æ—Ç—ã–µ –º–∏–Ω–µ—Ä–∞–ª—ã", resourcesNeeded: 20, resourcePrice: 7000 }
  ]
};

/* Utilities */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const fmt = n => (n===null||n===undefined||isNaN(n))?'-':String(Math.round(n)).replace(/\B(?=(\d{3})+(?!\d))/g,' ');
const escapeHtml = s => { const d=document.createElement('div'); d.textContent = s; return d.innerHTML; };

/* Refs */
const refs = {
  search: $('#search'),
  rep: $('#rep'),
  calcBtn: $('#calculate-btn'),
  tabs: $$('.tab'),
  individualBody: $('#individual-body'),
  personalBody: $('#personal-body'),
  nonpersonalBody: $('#nonpersonal-body'),
  individualPanel: $('#individual-panel'),
  personalPanel: $('#personal-panel'),
  nonpersonalPanel: $('#nonpersonal-panel'),
  summaryGrid: $('#summary'),
  refreshSummary: $('#refresh-summary')
};

let state = { lastResults: null, activeTab: 'individual' };

/* Calculation logic (–∫–∞–∫ —Ä–∞–Ω–µ–µ) */
function calculateAll(requiredRep){
  requiredRep = Math.max(1, Math.min(1000000, Number(requiredRep)||1));

  const individuals = CONFIG.individualItems.map(item=>{
    const repPer = Number(item.repPerUnit) || 1;
    const qty = Math.ceil(requiredRep / repPer);
    const totalCost = Math.round(qty * Number(item.price || 0));
    const totalWeight = Math.round(qty * Number(item.weight || 0) * 100) / 100;
    const repPerPrice = repPer ? Math.round((item.price||0) / repPer) : 0;
    return {...item, quantityNeeded: qty, totalCost, totalWeight, repPerPrice};
  }).sort((a,b)=>a.totalCost-b.totalCost);

  const personal = CONFIG.personalBoxes.map(box=>{
    const boxCost = box.resourcesNeeded * box.resourcePrice;
    const boxesNeeded = Math.ceil(requiredRep / 80);
    const totalCost = Math.round(boxesNeeded * boxCost);
    const totalWeight = boxesNeeded * 15;
    const repPerPrice = Math.round(boxCost / 80);
    return {...box, boxCost, boxesNeeded, totalCost, totalWeight, repPerPrice};
  }).sort((a,b)=>a.totalCost-b.totalCost);

  const nonpersonal = CONFIG.nonPersonalBoxes.map(box=>{
    const boxCost = box.resourcesNeeded * box.resourcePrice;
    const boxesNeeded = Math.ceil(requiredRep / 135);
    const totalCost = Math.round(boxesNeeded * boxCost);
    const totalWeight = boxesNeeded * 15;
    const repPerPrice = Math.round(boxCost / 135);
    return {...box, boxCost, boxesNeeded, totalCost, totalWeight, repPerPrice};
  }).sort((a,b)=>a.totalCost-b.totalCost);

  state.lastResults = { individuals, personal, nonpersonal, requiredRep };
  renderIndividuals(individuals);
  renderPersonal(personal);
  renderNonPersonal(nonpersonal);
  renderSummaryFromResults();
}

/* Renderers (–∫–∞–∫ —Ä–∞–Ω–µ–µ) */
function renderIndividuals(items){
  refs.individualBody.innerHTML = '';
  const frag = document.createDocumentFragment();
  const tpl = document.getElementById('row-template');

  items.forEach((it, idx)=>{
    const tr = tpl.content.firstElementChild.cloneNode(true);
    if(idx===0) tr.classList.add('best-option');
    else if(idx<5) tr.classList.add('good-option');
    else if(idx > items.length-5) tr.classList.add('bad-option');

    tr.querySelector('.col-name').innerHTML = escapeHtml(it.name);
    tr.querySelector('.col-death').textContent = it.deathDrop ? '‚úì' : '‚úó';
    tr.querySelector('.col-weight').textContent = it.weight > 0 ? it.weight + ' –∫–≥' : '-';
    tr.querySelector('.col-rep').textContent = it.repPerUnit;
    tr.querySelector('.col-price').textContent = fmt(it.price) + ' —Ä.';
    tr.querySelector('.col-rep-price').textContent = fmt(it.repPerPrice) + ' —Ä.';
    tr.querySelector('.col-quantity').textContent = fmt(it.quantityNeeded);
    tr.querySelector('.col-total-weight').textContent = it.totalWeight > 0 ? fmt(it.totalWeight) + ' –∫–≥' : '-';
    tr.querySelector('.col-total-cost').textContent = fmt(it.totalCost) + ' —Ä.';

    frag.appendChild(tr);
  });

  refs.individualBody.appendChild(frag);
}

function renderPersonal(items){
  refs.personalBody.innerHTML = '';
  const frag = document.createDocumentFragment();
  const tpl = document.getElementById('box-row-template');

  items.forEach((it, idx)=>{
    const tr = tpl.content.firstElementChild.cloneNode(true);
    if(idx===0) tr.classList.add('best-option');
    else if(idx<3) tr.classList.add('good-option');

    tr.querySelector('.col-name').innerHTML = escapeHtml(it.name);
    const qtyCells = tr.querySelectorAll('.col-quantity');
    const priceCells = tr.querySelectorAll('.col-price');
    const repPriceCells = tr.querySelectorAll('.col-rep-price');

    qtyCells[0].textContent = it.resourcesNeeded;
    priceCells[0].textContent = it.resourcePrice ? fmt(it.resourcePrice) + ' —Ä.' : '-';
    repPriceCells[0].textContent = it.boxCost ? fmt(it.boxCost) + ' —Ä.' : '-';
    repPriceCells[1].textContent = it.repPerPrice ? fmt(it.repPerPrice) + ' —Ä.' : '-';
    qtyCells[1].textContent = fmt(it.boxesNeeded);
    tr.querySelector('.col-total-weight').textContent = fmt(it.totalWeight) + ' –∫–≥';
    tr.querySelector('.col-total-cost').textContent = fmt(it.totalCost) + ' —Ä.';

    frag.appendChild(tr);
  });

  refs.personalBody.appendChild(frag);
}

function renderNonPersonal(items){
  refs.nonpersonalBody.innerHTML = '';
  const frag = document.createDocumentFragment();
  const tpl = document.getElementById('box-row-template');

  items.forEach((it, idx)=>{
    const tr = tpl.content.firstElementChild.cloneNode(true);
    if(idx===0 && it.resourcePrice>0) tr.classList.add('best-option');
    else if(idx<3 && it.resourcePrice>0) tr.classList.add('good-option');

    tr.querySelector('.col-name').innerHTML = escapeHtml(it.name);
    const qtyCells = tr.querySelectorAll('.col-quantity');
    const priceCells = tr.querySelectorAll('.col-price');
    const repPriceCells = tr.querySelectorAll('.col-rep-price');

    qtyCells[0].textContent = it.resourcesNeeded;
    priceCells[0].textContent = it.resourcePrice ? fmt(it.resourcePrice) + ' —Ä.' : '-';
    repPriceCells[0].textContent = it.boxCost ? fmt(it.boxCost) + ' —Ä.' : '-';
    repPriceCells[1].textContent = it.repPerPrice ? fmt(it.repPerPrice) + ' —Ä.' : '-';
    qtyCells[1].textContent = fmt(it.boxesNeeded);
    tr.querySelector('.col-total-weight').textContent = fmt(it.totalWeight) + ' –∫–≥';
    tr.querySelector('.col-total-cost').textContent = it.resourcePrice ? fmt(it.totalCost) + ' —Ä.' : '-';

    frag.appendChild(tr);
  });

  refs.nonpersonalBody.appendChild(frag);
}

/* Summary */
function renderSummaryFromResults(){
  refs.summaryGrid.innerHTML = '';
  if(!state.lastResults) return;
  const { individuals, personal, nonpersonal } = state.lastResults;

  const topIndividuals = individuals.slice(0,2).map(i=>({type:'–û—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç', icon:'üì¶', source:'individual', name:i.name, totalCost:i.totalCost, totalWeight:i.totalWeight, qty:i.quantityNeeded}));
  const topPersonal = personal.slice(0,2).map(p=>({type:'–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —è—â–∏–∫', icon:'üß∞', source:'personal', name:p.name, totalCost:p.totalCost, totalWeight:p.totalWeight, qty:p.boxesNeeded}));
  const topNon = nonpersonal.filter(n=>n.resourcePrice>0).slice(0,2).map(n=>({type:'–ù–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —è—â–∏–∫', icon:'üéí', source:'nonpersonal', name:n.name, totalCost:n.totalCost, totalWeight:n.totalWeight, qty:n.boxesNeeded}));

  const combined = [...topIndividuals, ...topPersonal, ...topNon].sort((a,b)=>a.totalCost-b.totalCost);

  const frag = document.createDocumentFragment();
  const tpl = document.getElementById('card-template');

  combined.forEach((c, idx)=>{
    const card = tpl.content.firstElementChild.cloneNode(true);
    card.querySelector('.icon').textContent = c.icon;
    card.querySelector('.type-label').textContent = ` ${c.type}`;
    card.querySelector('.name').textContent = c.name;
    card.querySelector('.meta').textContent = `${fmt(c.totalCost)} —Ä. ¬∑ ${fmt(c.totalWeight)} –∫–≥ ¬∑ –ö–æ–ª-–≤–æ: ${fmt(c.qty)}`;

    if(idx===0) card.classList.add('best');
    else if(idx<=2) card.classList.add('good');
    else card.classList.add('bad');

    card.style.cursor = 'pointer';
    card.addEventListener('click', ()=>{
      if(c.source === 'individual') activateTab('individual');
      else if(c.source === 'personal') activateTab('personal');
      else activateTab('non-personal');
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ –æ—Ç—Ä–µ–Ω–¥–µ—Ä–∏–ª–∞—Å—å
      setTimeout(() => {
        highlightRowByName(c.name, c.source);
        scrollToHighlightedRow(c.name, c.source);
      }, 100);
    });

    frag.appendChild(card);
  });

  refs.summaryGrid.appendChild(frag);
}

/* Highlight row - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø */
function highlightRowByName(name, source){
  const body = source === 'individual' ? refs.individualBody : (source === 'personal' ? refs.personalBody : refs.nonpersonalBody);
  if(!body) return;
  
  // –°–Ω–∞—á–∞–ª–∞ —Å–Ω–∏–º–∞–µ–º –≤—Å–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è
  body.querySelectorAll('tr').forEach(tr => {
    tr.style.outline = 'none';
    tr.style.boxShadow = 'none';
  });
  
  // –ò—â–µ–º —Å—Ç—Ä–æ–∫—É –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è
  const rows = Array.from(body.querySelectorAll('tr'));
  const match = rows.find(r => {
    const nameCell = r.querySelector('.col-name');
    return nameCell && nameCell.textContent.trim() === name.trim();
  });
  
  if(match){
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º box-shadow –¥–ª—è –±–æ–ª–µ–µ –∑–∞–º–µ—Ç–Ω–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è
    match.style.boxShadow = '0 0 0 3px rgba(212,184,92,0.6)';
    match.style.transition = 'box-shadow 0.3s ease';
    
    // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3.5 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(()=> {
      match.style.boxShadow = 'none';
    }, 3500);
  }
}

/* –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–µ */
function scrollToHighlightedRow(name, source){
  const body = source === 'individual' ? refs.individualBody : (source === 'personal' ? refs.personalBody : refs.nonpersonalBody);
  if(!body) return;
  
  const rows = Array.from(body.querySelectorAll('tr'));
  const match = rows.find(r => {
    const nameCell = r.querySelector('.col-name');
    return nameCell && nameCell.textContent.trim() === name.trim();
  });
  
  if(match){
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–µ
    match.scrollIntoView({
      behavior: 'smooth',
      block: 'center'
    });
  }
}

/* Search filter for visible tab */
function applySearchFilter(){
  const q = (refs.search.value || '').trim();
  const rx = q ? new RegExp(q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'), 'i') : null;
  const active = state.activeTab;
  const body = active === 'individual' ? refs.individualBody : (active === 'personal' ? refs.personalBody : refs.nonpersonalBody);
  if(!body) return;
  Array.from(body.querySelectorAll('tr')).forEach(tr=>{
    const nameCell = tr.querySelector('.col-name');
    const text = nameCell ? nameCell.textContent : '';
    if(!rx || rx.test(text)){
      tr.style.display = '';
      if(rx){
        const replaced = escapeHtml(text).replace(rx, m => `<span class="match">${m}</span>`);
        nameCell.innerHTML = replaced;
      } else {
        nameCell.innerHTML = escapeHtml(text);
      }
    } else {
      tr.style.display = 'none';
    }
  });
}

/* Tabs activation with visible contour behaviour */
function activateTab(id){
  refs.tabs.forEach(t => t.classList.remove('active'));
  const tab = refs.tabs.find(t => t.getAttribute('data-tab') === id);
  if(tab) tab.classList.add('active');
  state.activeTab = id;
  refs.individualPanel.style.display = id === 'individual' ? 'block' : 'none';
  refs.personalPanel.style.display = id === 'personal' ? 'block' : 'none';
  refs.nonpersonalPanel.style.display = id === 'non-personal' ? 'block' : 'none';
  applySearchFilter();
}

refs.tabs.forEach(t => {
  t.addEventListener('click', e => {
    const id = e.currentTarget.getAttribute('data-tab');
    activateTab(id);
  });
});

/* Events */
refs.calcBtn.addEventListener('click', ()=>{
  const rep = Number(refs.rep.value) || 1;
  refs.calcBtn.disabled = true;
  const prev = refs.calcBtn.textContent;
  refs.calcBtn.textContent = '–†–∞—Å—á—ë—Ç...';
  setTimeout(()=>{
    calculateAll(rep);
    refs.calcBtn.disabled = false;
    refs.calcBtn.textContent = prev;
  }, 60);
});

refs.search.addEventListener('input', applySearchFilter);
refs.refreshSummary.addEventListener('click', renderSummaryFromResults);

/* initial render */
calculateAll(Number(refs.rep.value) || 30000);
applySearchFilter();
</script>

<!-- –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞ (ID 104609292) -->
<script defer>
(function(m,e,t,r,i,k,a){
  m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
  m[i].l=1*new Date();
  k=e.createElement(t), a=e.getElementsByTagName(t)[0];
  k.async=1; k.src=r; a.parentNode.insertBefore(k,a);
})(window, document, "script", "https://mc.yandex.ru/metrika/tag.js?id=104609292", "ym");

ym(104609292, "init", { clickmap:true, trackLinks:true, accurateTrackBounce:true, webvisor:true });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/104609292" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

</body>
</html>
